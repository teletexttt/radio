<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teletext Radio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta property="og:title" content="Teletext Radio">
    <meta property="og:description" content="Patagonia Argentina">
    <meta property="og:image" content="https://teletexttt.github.io/radio/social-preview.png">
</head>
<body>
    <div class="fixed-player">
        <div class="player-left">
            <a href="#" class="station-logo">TXT</a>
            <div class="live-status">
                <span class="live-dot"></span>
                <span>EN VIVO</span>
            </div>
            <div class="current-show" id="currentShow">Cargando...</div>
        </div>
        <div class="player-center">
            <button class="play-button" id="radioPlayButton">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path id="playPath" d="M5 4L15 10L5 16V4Z"/>
                    <path id="pausePath1" d="M5 4H9V16H5V4Z" opacity="0"/>
                    <path id="pausePath2" d="M11 4H15V16H11V4Z" opacity="0"/>
                </svg>
            </button>
            <button class="share-button" id="shareRadioButton">
                <svg width="16" height="16" viewBox="0 0 24 24">
                    <path d="M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.35C15.11 18.56 15.08 18.78 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08Z"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="main-content">
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Teletext Radio</h1>
                <p class="hero-subtitle">Radio Online desde la Patagonia Argentina</p>
            </div>
        </section>

        <section class="content-section">
            <h2 id="currentProgramTitle">Cargando programa...</h2>
            <div id="playerStatus">Presiona PLAY para comenzar</div>
            <div id="nowPlaying">-</div>
        </section>
    </div>

    <audio id="radioPlayer" preload="none"></audio>

    <!-- ESTE ES EL SCRIPT CORRECTO -->
    <script>
// ===== CONFIGURACIÃ“N INICIAL =====
const PROGRAMAS = {
    1: { nombre: "Madrugada txt", carpeta: "madrugadatxt" },
    6: { nombre: "Telesoft", carpeta: "telesoft" },
    12: { nombre: "Radio 404", carpeta: "radio404" },
    16: { nombre: "Floppy Disk", carpeta: "especialestxt" },
    20: { nombre: "Piratas InformÃ¡ticos", carpeta: "teletext" }
};

let playlistActual = [];
let indiceActual = 0;
let estaReproduciendo = false;
const audio = document.getElementById('radioPlayer');

// ===== FUNCIONES BÃSICAS =====
function obtenerHoraArgentina() {
    const ahora = new Date();
    const offsetArg = -3; // UTC-3
    const offsetLocal = ahora.getTimezoneOffset() / 60;
    const diferencia = offsetArg + offsetLocal;
    return new Date(ahora.getTime() + diferencia * 3600000);
}

function obtenerProgramaActual() {
    const horaArg = obtenerHoraArgentina().getHours();
    
    if (horaArg >= 1 && horaArg < 6) return PROGRAMAS[1];
    if (horaArg >= 6 && horaArg < 12) return PROGRAMAS[6];
    if (horaArg >= 12 && horaArg < 16) return PROGRAMAS[12];
    if (horaArg >= 16 && horaArg < 20) return PROGRAMAS[16];
    return PROGRAMAS[20]; // 20:00 a 01:00
}

async function cargarPlaylistDelPrograma() {
    const programa = obtenerProgramaActual();
    
    // Actualizar interfaz
    document.getElementById('currentShow').textContent = programa.nombre;
    document.getElementById('currentProgramTitle').textContent = `EN VIVO: ${programa.nombre}`;
    
    try {
        const respuesta = await fetch(`music/${programa.carpeta}/playlist.json`);
        const datos = await respuesta.json();
        playlistActual = datos.tracks || [];
        
        if (playlistActual.length > 0) {
            console.log(`âœ… Playlist cargada: ${playlistActual.length} canciones`);
            // Si estaba reproduciendo, continuar con nueva playlist
            if (estaReproduciendo) {
                indiceActual = 0;
                reproducirCancionActual();
            }
        } else {
            console.warn('âš ï¸ Playlist vacÃ­a');
        }
    } catch (error) {
        console.error('âŒ Error cargando playlist:', error);
        // Playlist de emergencia
        playlistActual = [
            { url: 'music/teletext/toclimbthecliff.mp3', duration: 300 },
            { url: 'music/teletext/doomsday.mp3', duration: 300 }
        ];
    }
}

function reproducirCancionActual() {
    if (playlistActual.length === 0) return;
    
    const cancion = playlistActual[indiceActual];
    audio.src = cancion.url || cancion.path || cancion.file;
    
    audio.play().then(() => {
        estaReproduciendo = true;
        actualizarInterfazReproduccion();
    }).catch(error => {
        console.error('Error al reproducir:', error);
        reproducirSiguiente();
    });
}

function reproducirSiguiente() {
    if (playlistActual.length === 0) return;
    indiceActual = (indiceActual + 1) % playlistActual.length;
    reproducirCancionActual();
}

function actualizarInterfazReproduccion() {
    const boton = document.getElementById('radioPlayButton');
    const playIcon = document.getElementById('playPath');
    const pauseIcon1 = document.getElementById('pausePath1');
    const pauseIcon2 = document.getElementById('pausePath2');
    
    if (estaReproduciendo) {
        playIcon.setAttribute('opacity', '0');
        pauseIcon1.setAttribute('opacity', '1');
        pauseIcon2.setAttribute('opacity', '1');
        document.getElementById('playerStatus').textContent = 'Reproduciendo...';
    } else {
        playIcon.setAttribute('opacity', '1');
        pauseIcon1.setAttribute('opacity', '0');
        pauseIcon2.setAttribute('opacity', '0');
        document.getElementById('playerStatus').textContent = 'Pausado';
    }
}

// ===== EVENTOS =====
document.getElementById('radioPlayButton').addEventListener('click', function() {
    if (playlistActual.length === 0) {
        cargarPlaylistDelPrograma().then(() => {
            if (playlistActual.length > 0) {
                reproducirCancionActual();
            }
        });
        return;
    }
    
    if (estaReproduciendo) {
        audio.pause();
        estaReproduciendo = false;
    } else {
        audio.play().then(() => estaReproduciendo = true);
    }
    actualizarInterfazReproduccion();
});

document.getElementById('shareRadioButton').addEventListener('click', function() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        const original = this.innerHTML;
        this.innerHTML = 'âœ“';
        this.style.color = '#00FF37';
        setTimeout(() => {
            this.innerHTML = original;
            this.style.color = '';
        }, 2000);
    });
});

audio.addEventListener('ended', reproducirSiguiente);
audio.addEventListener('error', reproducirSiguiente);

// ===== INICIALIZACIÃ“N =====
// Cargar el programa actual al inicio
cargarPlaylistDelPrograma();

// Verificar cambio de programa cada minuto
setInterval(cargarPlaylistDelPrograma, 60000);

// Verificar si la reproducciÃ³n se detuvo
setInterval(() => {
    if (estaReproduciendo && audio.paused && !audio.ended) {
        audio.play().catch(() => reproducirSiguiente());
    }
}, 5000);

console.log('ðŸ“» Teletext Radio - Sistema bÃ¡sico activado');
    </script>
</body>
</html>
