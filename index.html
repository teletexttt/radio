<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preload" href="Chomsky.otf" as="font" type="font/otf" crossorigin>
    <link rel="stylesheet" href="styles.css">
    <title>Teletext Radio</title>
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.txtradio.site/">
    <meta property="og:title" content="Teletext Radio">
    <meta property="og:description" content="Patagonia Argentina">
    <meta property="og:image" content="https://www.txtradio.site/social-preview.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Vista previa de Teletext Radio">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@teletextlab">
    <meta name="twitter:creator" content="@teletextlab">
    <meta name="twitter:title" content="Teletext Radio">
    <meta name="twitter:description" content="Patagonia Argentina">
    <meta name="twitter:image" content="https://www.txtradio.site/social-preview.png">
    <meta name="twitter:image:alt" content="Vista previa de Teletext Radio">
</head>
<body>
    <div class="fixed-player">
        <div class="player-left">
            <a href="#" class="station-logo">TXT</a>
            <div class="live-status">
                <span class="live-dot"></span>
                <span class="live-text">EN VIVO</span>
            </div>
            <div class="current-show" id="currentShow">Cargando programaci√≥n...</div>
        </div>
        
        <div class="player-center">
            <button class="play-button" id="radioPlayButton" aria-label="Reproducir/Pausar">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path id="playPath" d="M5 4L15 10L5 16V4Z"/>
                    <path id="pausePath1" d="M5 4H9V16H5V4Z" opacity="0"/>
                    <path id="pausePath2" d="M11 4H15V16H11V4Z" opacity="0"/>
                </svg>
            </button>
            <button class="share-button" id="shareRadioButton" aria-label="Compartir radio" title="Copiar enlace">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18 16.08C17.24 16.08 16.56 16.38 16.04 16.85L8.91 12.7C8.96 12.47 9 12.24 9 12C9 11.76 8.96 11.53 8.91 11.3L15.96 7.19C16.5 7.69 17.21 8 18 8C19.66 8 21 6.66 21 5C21 3.34 19.66 2 18 2C16.34 2 15 3.34 15 5C15 5.24 15.04 5.47 15.09 5.7L8.04 9.81C7.5 9.31 6.79 9 6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15C6.79 15 7.5 14.69 8.04 14.19L15.16 18.35C15.11 18.56 15.08 18.78 15.08 19C15.08 20.61 16.39 21.92 18 21.92C19.61 21.92 20.92 20.61 20.92 19C20.92 17.39 19.61 16.08 18 16.08Z"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="main-content">
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">Teletext Radio</h1>
                <p class="hero-subtitle">Txt es una Radio Online creada por amantes de la m√∫sica para amantes de la m√∫sica.</p>
            </div>
        </section>

        <section class="content-section">
            <div class="now-playing">
                <h2 class="section-title">EN VIVO <span>AHORA</span></h2>
                <div class="current-time-block">
                    <div class="time-title">Est√°s escuchando</div>
                    <div class="time-name" id="currentTimeName">Cargando...</div>
                    <div class="time-range" id="currentTimeRange">--:-- -- --:-- --</div>
                </div>
            </div>
        </section>

        <section class="content-section" style="background: rgba(20, 20, 20, 0.92);">
            <div class="schedule-section">
                <h2 class="section-title">PROGRAMACI√ìN <span>DIARIA</span></h2>
                <div class="schedule-grid"></div>
            </div>
        </section>

        <section class="content-section">
            <div class="novedades-section">
                <h2 class="section-title">NOVEDADES <span>TXT</span></h2>
                <div class="novedades-grid">
                    <div class="novedad-card">
                        <div class="novedad-imagen">
                            <img src="novedades/evento1.png" alt="Orto Galeria" loading="lazy">
                        </div>
                        <div class="novedad-texto">
                            <p>Orto Galer√≠a del Litoral banca este espacio. Arte que no decora: incomoda, pregunta, circula.</p>
                        </div>
                    </div>
                    
                    <div class="novedad-card">
                        <div class="novedad-imagen">
                            <img src="novedades/evento2.jpg" alt="Teletext Radio" loading="lazy">
                        </div>
                        <div class="novedad-texto">
                            <p>Apoy√° Teletext Radio. Radio independiente sostenida por quienes la escuchan. Sin algoritmos. Sin ruido. Con criterio.</p>
                        </div>
                    </div>
                    
                    <div class="novedad-card">
                        <div class="novedad-imagen">
                            <img src="novedades/evento3.png" alt="Archivos Perdidos" loading="lazy">
                        </div>
                        <div class="novedad-texto">
                            <p>Estrenamos "Archivos Perdidos", una secci√≥n los domingos a las 22hs donde rescatamos grabaciones raras, demos in√©ditos y sesiones de estudio nunca antes escuchadas. Primera edici√≥n: sesiones de synthwave argentino 1985-1990.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="content-section" style="background: rgba(20, 20, 20, 0.92);">
            <div class="info-section">
                <h2 class="section-title">INFORMACI√ìN <span>& APOYO</span></h2>
                <div class="info-content">
                    <p class="info-text">
                        Teletext Radio es una plataforma independiente que transmite m√∫sica las 24 horas, con sede en la Patagonia Argentina. 
                        Nuestro objetivo es ofrecer una experiencia auditiva √∫nica, combinando programaci√≥n autom√°tica con selecciones curadas.
                    </p>
                    <a href='https://cafecito.app/teletext' class="cafecito-link" target="_blank" rel="noopener">
                        <span>üåπ Apoya este proyecto en Cafecito</span>
                    </a>
                </div>
            </div>
        </section>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-column">
                    <h3 class="footer-title">Teletext Radio</h3>
                    <ul class="footer-links">
                        <li><a href="#now-playing">En Vivo</a></li>
                        <li><a href="#schedule">Programaci√≥n</a></li>
                        <li><a href="#collections">Colecciones</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3 class="footer-title">Contacto</h3>
                    <ul class="footer-links">
                        <li><a href="https://www.instagram.com/teletextradio/" target="_blank" rel="noopener">Instagram</a></li>
                        <li><a href="mailto:rteletextradio@gmail.com">Email</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3 class="footer-title">Enlaces</h3>
                    <ul class="footer-links">
                        <li><a href="https://cafecito.app/teletext" target="_blank" rel="noopener">Apoyar en Cafecito</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="sponsors-section">
                <div class="sponsors-title">Patrocina</div>
                <div class="sponsors-container">
                    <div class="sponsor-item">
                        <a href="https://www.instagram.com/ortogaleria/" target="_blank" rel="noopener" class="sponsor-link">
                            <img src="sponsors/globo.png" class="sponsor-logo" alt="Orto Galeria">
                        </a>
                        <div class="sponsor-name">Orto Galeria</div>
                    </div>
                    
                    <div class="sponsor-item">
                        <a href="https://www.instagram.com/teletextlab/" target="_blank" rel="noopener" class="sponsor-link">
                            <img src="sponsors/globo.png" class="sponsor-logo" alt="Teletextlab">
                        </a>
                        <div class="sponsor-name">Teletextlab</div>
                    </div>
                    
                    <div class="sponsor-item">
                        <a href="https://www.youtube.com/@txtradio" target="_blank" rel="noopener" class="sponsor-link">
                            <img src="sponsors/globo.png" class="sponsor-logo" alt="Cyberespacio">
                        </a>
                        <div class="sponsor-name">Cyberespacio</div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <div class="copyright-content">
                    ¬© 2025 Teletextlab. Patagonia Argentina. Todos los derechos reservados.
                </div>
            </div>
        </footer>
    </div>

    <audio id="radioPlayer"></audio>

    <script>
        // TELEXT RADIO - MODO SIMPLE (ESTA SEMANA)
        document.addEventListener('DOMContentLoaded', function() {
            const playButton = document.getElementById('radioPlayButton');
            const shareButton = document.getElementById('shareRadioButton');
            let audioPlayer = document.getElementById('radioPlayer');
            const playPath = document.getElementById('playPath');
            const pausePath1 = document.getElementById('pausePath1');
            const pausePath2 = document.getElementById('pausePath2');
            const currentShow = document.getElementById('currentShow');
            const currentTimeName = document.getElementById('currentTimeName');
            const currentTimeRange = document.getElementById('currentTimeRange');
            const scheduleGrid = document.querySelector('.schedule-grid');
            
            let isPlaying = false;
            let currentPlaylist = [];
            let currentTrackIndex = 0;
            let currentSchedule = null;
            
            // ========== CONFIGURACI√ìN DE PROGRAMAS ==========
            const programNames = {
                "madrugada": "Radio 404",
                "ma√±ana": "Archivo txt", 
                "tarde": "Telesoft",
                "mediatarde": "Floppy Disk",
                "noche": "Internet Archive",
                "especial": "Especiales txt"
            };
            
            const programDescriptions = {
                "madrugada": "Sonidos atmosf√©ricos y experimentales para las primeras horas del d√≠a.",
                "ma√±ana": "Programa matutino con energ√≠a y ritmos para comenzar el d√≠a.",
                "tarde": "Ritmos variados y selecciones especiales para acompa√±ar la tarde.",
                "mediatarde": "Transici√≥n hacia la noche con sonidos m√°s atmosf√©ricos.",
                "noche": "Sesiones extendidas y atm√≥sferas nocturnas para terminar el d√≠a.",
                "especial": "Programaci√≥n especial viernes y s√°bados de 22:00 a 00:00. Seguinos en nuestras redes para mas info."
            };
            
            const scheduleData = {
                "schedules": [
                    {
                        "name": "madrugada",
                        "displayName": "Radio 404",
                        "start": "01:00",
                        "end": "06:00",
                        "description": programDescriptions.madrugada
                    },
                    {
                        "name": "ma√±ana",
                        "displayName": "Archivo txt",
                        "start": "06:00",
                        "end": "12:00",
                        "description": programDescriptions.ma√±ana
                    },
                    {
                        "name": "tarde",
                        "displayName": "Telesoft",
                        "start": "12:00",
                        "end": "16:00",
                        "description": programDescriptions.tarde
                    },
                    {
                        "name": "mediatarde",
                        "displayName": "Floppy Disk",
                        "start": "16:00",
                        "end": "20:00",
                        "description": programDescriptions.mediatarde
                    },
                    {
                        "name": "noche",
                        "displayName": "Internet Archive",
                        "start": "20:00",
                        "end": "01:00",
                        "description": programDescriptions.noche
                    },
                    {
                        "name": "especial",
                        "displayName": "Especiales txt",
                        "start": "22:00",
                        "end": "00:00",
                        "description": programDescriptions.especial
                    }
                ]
            };
            
            // ========== FUNCIONES B√ÅSICAS ==========
            function getArgentinaTime() {
                const now = new Date();
                const argentinaOffset = -3 * 60;
                const localOffset = now.getTimezoneOffset();
                const offsetDiff = argentinaOffset + localOffset;
                return new Date(now.getTime() + offsetDiff * 60000);
            }
            
            function formatTimeForDisplay(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                const period = hours >= 12 ? 'PM' : 'AM';
                const displayHours = hours % 12 || 12;
                return `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
            }
            
            function getCurrentSchedule() {
                const now = getArgentinaTime();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentTime = currentHour * 60 + currentMinute;
                
                for (const regular of scheduleData.schedules) {
                    const startTime = parseInt(regular.start.split(':')[0]) * 60 + parseInt(regular.start.split(':')[1]);
                    let endTime = parseInt(regular.end.split(':')[0]) * 60 + parseInt(regular.end.split(':')[1]);
                    
                    if (endTime < startTime) {
                        endTime += 24 * 60;
                        const adjustedCurrentTime = currentTime + (currentTime < startTime ? 24 * 60 : 0);
                        if (adjustedCurrentTime >= startTime && adjustedCurrentTime < endTime) {
                            return regular;
                        }
                    } else {
                        if (currentTime >= startTime && currentTime < endTime) {
                            return regular;
                        }
                    }
                }
                
                return scheduleData.schedules[0];
            }
            
            // ========== PLAYLIST SIMPLE ==========
            async function loadSimplePlaylist() {
                try {
                    console.log('üìª Cargando playlist simple...');
                    const response = await fetch('playlist.json');
                    
                    if (!response.ok) {
                        throw new Error('No se encontr√≥ playlist.json');
                    }
                    
                    const data = await response.json();
                    
                    // Convertir strings a objetos
                    currentPlaylist = data.tracks.map(trackPath => ({
                        path: trackPath,
                        file: trackPath.split('/').pop(),
                        duration: 240
                    }));
                    
                    // ‚≠ê SIEMPRE EMPIEZA DESDE LA PRIMERA ‚≠ê
                    currentTrackIndex = 0;
                    
                    console.log(`‚úÖ ${currentPlaylist.length} canciones cargadas (Modo Simple)`);
                    
                } catch (error) {
                    console.error('Error cargando playlist:', error);
                    currentPlaylist = [
                        {path: 'music/jazzcartel.mp3', file: 'jazzcartel.mp3', duration: 240}
                    ];
                    currentTrackIndex = 0;
                }
            }
            
            function playNextTrack() {
                if (currentPlaylist.length === 0) {
                    loadSimplePlaylist().then(() => {
                        if (currentPlaylist.length > 0) {
                            currentTrackIndex = 0;
                            playCurrentTrack();
                        }
                    });
                    return;
                }
                
                currentTrackIndex = (currentTrackIndex + 1) % currentPlaylist.length;
                console.log(`‚è≠Ô∏è Siguiente: ${currentTrackIndex + 1}/${currentPlaylist.length}`);
                playCurrentTrack();
            }
            
            function playCurrentTrack() {
                if (currentPlaylist.length === 0) return;
                
                const track = currentPlaylist[currentTrackIndex];
                console.log(`üéµ ${track.file} (${currentTrackIndex + 1}/${currentPlaylist.length})`);
                
                audioPlayer.onended = null;
                audioPlayer.onerror = null;
                audioPlayer.pause();
                audioPlayer.currentTime = 0;
                
                audioPlayer.src = track.path;
                
                const tryPlay = () => {
                    if (isPlaying) {
                        audioPlayer.play().catch(e => {
                            console.error('‚ùå Error:', e);
                            setTimeout(() => playNextTrack(), 1000);
                        });
                    }
                };
                
                audioPlayer.addEventListener('loadedmetadata', function onMetadata() {
                    audioPlayer.removeEventListener('loadedmetadata', onMetadata);
                    audioPlayer.currentTime = 0;
                    tryPlay();
                }, { once: true });
                
                if (audioPlayer.readyState >= 1) {
                    audioPlayer.currentTime = 0;
                    tryPlay();
                }
                
                audioPlayer.onended = function() {
                    console.log('‚úÖ Canci√≥n terminada, siguiente...');
                    playNextTrack();
                };
                
                audioPlayer.onerror = function() {
                    console.error('‚ùå Error de audio...');
                    setTimeout(() => playNextTrack(), 500);
                };
            }
            
            // ========== INTERFAZ ==========
            function updateDisplayInfo() {
                currentSchedule = getCurrentSchedule();
                const displayName = currentSchedule.displayName || programNames[currentSchedule.name] || currentSchedule.name;
                
                currentShow.textContent = displayName;
                currentTimeName.textContent = displayName;
                currentTimeRange.textContent = `${formatTimeForDisplay(currentSchedule.start)} - ${formatTimeForDisplay(currentSchedule.end)}`;
            }
            
            function generateScheduleCards() {
                if (!scheduleGrid) return;
                
                scheduleGrid.innerHTML = '';
                
                scheduleData.schedules.forEach(schedule => {
                    const card = document.createElement('div');
                    card.className = 'schedule-card';
                    
                    const displayName = schedule.displayName || programNames[schedule.name] || schedule.name;
                    const description = schedule.description || programDescriptions[schedule.name] || 'Programaci√≥n autom√°tica';
                    
                    card.innerHTML = `
                        <div class="schedule-time">${formatTimeForDisplay(schedule.start)} - ${formatTimeForDisplay(schedule.end)}</div>
                        <div class="schedule-name">${displayName}</div>
                        <div class="schedule-desc">${description}</div>
                    `;
                    
                    scheduleGrid.appendChild(card);
                });
            }
            
            function updatePlayButton() {
                if (isPlaying) {
                    playPath.setAttribute('opacity', '0');
                    pausePath1.setAttribute('opacity', '1');
                    pausePath2.setAttribute('opacity', '1');
                    playButton.setAttribute('aria-label', 'Pausar');
                } else {
                    playPath.setAttribute('opacity', '1');
                    pausePath1.setAttribute('opacity', '0');
                    pausePath2.setAttribute('opacity', '0');
                    playButton.setAttribute('aria-label', 'Reproducir');
                }
            }
            
            function shareRadio() {
                const url = window.location.href;
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(url).then(() => {
                        const originalHTML = shareButton.innerHTML;
                        shareButton.innerHTML = '‚úÖ';
                        shareButton.style.borderColor = '#00FF37';
                        setTimeout(() => {
                            shareButton.innerHTML = originalHTML;
                            shareButton.style.borderColor = '';
                        }, 2000);
                    });
                }
            }
            
            // ========== EVENTOS ==========
            playButton.addEventListener('click', async function() {
                if (isPlaying) {
                    audioPlayer.pause();
                    isPlaying = false;
                } else {
                    if (currentPlaylist.length === 0) {
                        await loadSimplePlaylist();
                    }
                    isPlaying = true;
                    playCurrentTrack();
                }
                updatePlayButton();
            });
            
            shareButton.addEventListener('click', shareRadio);
            
            // ========== INICIALIZACI√ìN ==========
            async function init() {
                console.log('üöÄ Iniciando Teletext Radio (Modo Simple)');
                
                await loadSimplePlaylist();
                updateDisplayInfo();
                generateScheduleCards();
                
                setInterval(updateDisplayInfo, 60000);
                
                setInterval(() => {
                    if (isPlaying && audioPlayer.paused && !audioPlayer.ended) {
                        console.log('‚ö†Ô∏è Audio ca√≠do, reintentando...');
                        audioPlayer.play().catch(() => playNextTrack());
                    }
                }, 5000);
                
                console.log('‚úÖ Radio lista en MODO SIMPLE');
            }
            
            init();
        });
    </script>
</body>
</html>
